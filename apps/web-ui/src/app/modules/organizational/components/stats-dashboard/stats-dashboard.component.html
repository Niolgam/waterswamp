<div class="stats-dashboard">
  <div class="dashboard-header">
    <h2>Painel de Sincroniza√ß√£o SIORG</h2>
    <div class="header-actions">
      <label class="auto-refresh-toggle">
        <input type="checkbox" [(ngModel)]="autoRefresh" (change)="toggleAutoRefresh()" />
        Atualiza√ß√£o Autom√°tica (30s)
      </label>
      <button class="btn btn-refresh" (click)="refresh()" [disabled]="loading">
        üîÑ Atualizar
      </button>
    </div>
  </div>

  <div *ngIf="loading && !stats" class="loading">
    Carregando estat√≠sticas...
  </div>

  <div *ngIf="error" class="error">
    {{ error }}
  </div>

  <div *ngIf="stats && health" class="dashboard-content">
    <!-- Health Status Card -->
    <div class="card health-card" [ngClass]="getHealthStatusClass()">
      <div class="card-header">
        <h3>{{ getHealthStatusIcon() }} Status do Sistema</h3>
      </div>
      <div class="card-body">
        <div class="health-info">
          <div class="health-status">{{ health.status.toUpperCase() }}</div>
          <div class="health-message">{{ health.message }}</div>
          <div class="health-metrics">
            <div class="metric">
              <span class="label">Fila:</span>
              <span class="value">{{ health.queue_size }}</span>
            </div>
            <div class="metric">
              <span class="label">Conflitos:</span>
              <span class="value">{{ health.conflicts_count }}</span>
            </div>
            <div class="metric">
              <span class="label">Falhas:</span>
              <span class="value">{{ health.failures_count }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Queue Statistics -->
    <div class="card queue-card">
      <div class="card-header">
        <h3>üìä Estat√≠sticas da Fila</h3>
      </div>
      <div class="card-body">
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-label">Pendentes</div>
            <div class="stat-value pending">{{ queueStats?.pending || 0 }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Processando</div>
            <div class="stat-value processing">{{ queueStats?.processing || 0 }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Conclu√≠dos</div>
            <div class="stat-value completed">{{ queueStats?.completed || 0 }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Falhas</div>
            <div class="stat-value failed">{{ queueStats?.failed || 0 }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Conflitos</div>
            <div class="stat-value conflicts">{{ queueStats?.conflicts || 0 }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Ignorados</div>
            <div class="stat-value skipped">{{ queueStats?.skipped || 0 }}</div>
          </div>
        </div>

        <div class="stats-summary">
          <div class="summary-item">
            <span class="label">Total:</span>
            <span class="value">{{ queueStats?.total || 0 }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Taxa de Pendentes:</span>
            <span class="value">{{ formatPercentage(queueStats?.pending_rate || 0) }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Taxa de Conclus√£o:</span>
            <span class="value">{{ formatPercentage(queueStats?.completion_rate || 0) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Conflict Statistics -->
    <div class="card conflicts-card">
      <div class="card-header">
        <h3>‚ö†Ô∏è Estat√≠sticas de Conflitos</h3>
      </div>
      <div class="card-body">
        <div class="conflicts-summary">
          <div class="summary-item large">
            <span class="label">Total N√£o Resolvidos:</span>
            <span class="value conflicts">{{ conflictStats?.total_unresolved || 0 }}</span>
          </div>
          <div class="summary-item" *ngIf="conflictStats?.oldest_conflict_age_hours">
            <span class="label">Conflito Mais Antigo:</span>
            <span class="value">{{ formatHours(conflictStats.oldest_conflict_age_hours) }}</span>
          </div>
          <div class="summary-item" *ngIf="conflictStats?.avg_resolution_time_hours">
            <span class="label">Tempo M√©dio de Resolu√ß√£o:</span>
            <span class="value">{{ formatHours(conflictStats.avg_resolution_time_hours) }}</span>
          </div>
        </div>

        <div class="entity-type-breakdown" *ngIf="entityTypeEntries.length > 0">
          <h4>Por Tipo de Entidade</h4>
          <div class="breakdown-list">
            <div class="breakdown-item" *ngFor="let entry of entityTypeEntries">
              <span class="type">{{ getEntityTypeLabel(entry[0]) }}:</span>
              <span class="count">{{ entry[1] }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- History Statistics -->
    <div class="card history-card">
      <div class="card-header">
        <h3>üìú Hist√≥rico de Sincroniza√ß√£o</h3>
      </div>
      <div class="card-body">
        <div class="history-summary">
          <div class="summary-item">
            <span class="label">Total de Entradas:</span>
            <span class="value">{{ historyStats?.total_entries || 0 }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Revis√µes Pendentes:</span>
            <span class="value">{{ historyStats?.pending_reviews || 0 }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Mudan√ßas (24h):</span>
            <span class="value">{{ historyStats?.last_24h_changes || 0 }}</span>
          </div>
        </div>

        <div class="change-type-breakdown" *ngIf="changeTypeEntries.length > 0">
          <h4>Por Tipo de Mudan√ßa</h4>
          <div class="breakdown-list">
            <div class="breakdown-item" *ngFor="let entry of changeTypeEntries">
              <span class="type">{{ getChangeTypeLabel(entry[0]) }}:</span>
              <span class="count">{{ entry[1] }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Processing Statistics (Placeholder for future time-based data) -->
    <div class="card processing-card">
      <div class="card-header">
        <h3>‚öôÔ∏è Estat√≠sticas de Processamento</h3>
      </div>
      <div class="card-body">
        <p class="info-message">
          Estat√≠sticas de processamento baseadas em tempo ser√£o implementadas
          quando a filtragem temporal estiver dispon√≠vel no reposit√≥rio.
        </p>
      </div>
    </div>

    <div class="last-updated">
      √öltima atualiza√ß√£o: {{ stats.last_updated | date: 'dd/MM/yyyy HH:mm:ss' }}
    </div>
  </div>
</div>
